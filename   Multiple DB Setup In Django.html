<div class="note-header">Multiple DB setup in Django</div><div class="step-header">Step: 1 Update settings.py .<br></div><div class="description"><div>For MongoDB the following configuration works: <br></div><div><br></div>DATABASES = {<br>&nbsp;&nbsp;&nbsp; 'default': {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ENGINE': 'django.db.backends.sqlite3',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),<br>&nbsp;&nbsp;&nbsp; },<br>&nbsp;&nbsp;&nbsp; 'second': {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ENGINE': 'djongo',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'NAME': 'db-name',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'CLIENT': {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'host': '127.0.0.1',&nbsp;&nbsp; // or&nbsp; host name<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'port': 27017,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'authSource': 'equinix',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}<br><div><br></div><div><br></div><div>============================================================</div><div><br></div><div>For MySQL the following configuration works:</div><div><br></div><div><br></div><div>&nbsp;DATABASES = {<br>&nbsp;&nbsp;&nbsp; 'default': {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ENGINE': 'django.db.backends.sqlite3',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),<br>&nbsp;&nbsp;&nbsp; },<br>&nbsp;&nbsp; 'second': {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'ENGINE': 'django.db.backends.mysql',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'NAME': 'database-name',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'USER': 'username',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'PASSWORD': 'password',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'HOST': 'localhost',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'PORT': '3306',<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br></div><div><br></div><div><br></div><div><br></div></div><div class="step-header">Step: 2&nbsp; To the same settings.py add the below piece of code.<br></div><div class="description"><span class="pl-v">DATABASE_ROUTERS</span> <span class="pl-c1">=</span> [<span class="pl-s">'path.to.the.dbrouterfilename.DbRouter'</span>]</div><div class="step-header">Step: 3 Create a dbrouter.py file in a location you specified in <span class="pl-v">DATABASE_ROUTERS in settings. (In this example, we are assuming that we have created an app called "secondapp" and we want that app to use the database "second" which is defined in settings.py)<br></span></div><div class="description">class DbRouter(object):<br>&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp; A router to control all database operations on models in the<br>&nbsp;&nbsp;&nbsp; auth application.<br>&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp; def db_for_read(self, model=None, **hints):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Attempts to read secondapp models go to second database.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if model is not None:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if model._meta.app_label == 'secondapp':<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 'second'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return None<br><br>&nbsp;&nbsp;&nbsp; def db_for_write(self, model=None, **hints):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Attempts to write secondapp models go to the second database.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if model is not None:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if model._meta.app_label == 'secondapp':<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 'second'<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return None<br><br>&nbsp;&nbsp;&nbsp; def allow_relation(self, obj1, obj2, **hints):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Allow relations if a model in the user app is involved.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if obj1._meta.app_label == 'secondapp' or \<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; obj2._meta.app_label == 'secondapp':<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return None<br><br>&nbsp;&nbsp;&nbsp; def allow_migrate(self, db, app_label, model=None, **hints):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Do not allow migrations on the second database<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; """<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if model is not None:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if model._meta.app_label == 'secondapp':<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "second"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "default"<br><br></div><div class="step-header">Step: 4&nbsp; Now define some models in "secondapp"&nbsp; models.py<br></div><div class="description">class company(models.Model):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; groupname = models.CharField(max_length=100,primary_key=True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; company = models.CharField(max_length=100)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; employername = models.CharField(max_length=100) &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; location = models.CharField(max_length=100)<br><br>class employee(models.Model):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; firstname = models.CharField(max_length=100,primary_key=True)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lastname = models.CharField(max_length=100)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dob = models.CharField(max_length=100)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joindate = models.CharField(max_length=100)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; skills = models.CharField(max_length=100)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br></div><div class="step-header">Step: 5 So whenever&nbsp; view function of the "secondapp" uses any of these models to fetch data from db the request will be redirected to the database "second" by the DBrouter(dbrouter.py)<br></div><div class="description"><div>We need to import models of all the apps and then we can use them in views.py<br></div><div><br></div><div>sample queries that can be used in views.py functions:</div><div>&nbsp;</div><div>#to get data from table "company"<br></div><div><span class="pl-s1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; group_details1</span> <span class="pl-c1">=</span> company.<span class="pl-s1">objects</span>.<span class="pl-en">get</span>(<span class="pl-s1">groupname</span><span class="pl-c1">="something"</span>)</div><div><br></div><div># to get data from table "employee"<br></div><div><span class="pl-s1">&nbsp;&nbsp;&nbsp;&nbsp; group_details1</span> <span class="pl-c1">=</span> employee.<span class="pl-s1">objects</span>.<span class="pl-en">get</span>(firstname<span class="pl-c1">=</span>"john")</div><div>&nbsp;&nbsp;&nbsp; #to get all rows of <br></div><div><span class="pl-s1">&nbsp;&nbsp;&nbsp; alldata</span> <span class="pl-c1">=</span> employee.<span class="pl-s1">objects</span>.<span class="pl-en">all</span>()</div></div>